<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Your ZTC Cart • West Los Angeles College</title>
  <style>
    :root{ --navy:#002147; --gold:#fdb813; --gray:#eaeaec; --text:#0f172a; }
    html,body{background:#fff;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
    header,footer{padding:16px;background:#f7f7f8;border-bottom:1px solid #ddd}
    header .btn, footer .btn{background:var(--navy);color:#fff;padding:10px 14px;text-decoration:none;border-radius:8px;font-weight:700;display:inline-block}
    h1{margin:20px;color:var(--navy)}
    main{max-width:1100px;margin:0 auto;padding:0 16px 28px}
    table{width:100%;border-collapse:collapse;margin:12px 0}
    th,td{border:1px solid var(--gray);padding:8px;text-align:left}
    thead th{background:var(--navy);color:#fff}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    .actions button{background:var(--gold);color:#000;border:0;border-radius:8px;padding:10px 12px;font-weight:700;cursor:pointer}
    .danger{background:#ffe9e9;color:#b30000}
    .muted{color:#475569}
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="btn">← Back to Search</a>
  </header>

  <main>
    <h1>Your ZTC Cart</h1>
    <p class="muted">These are the sections you saved from the ZTC Search page.</p>

    <table id="cartTable" aria-label="Saved ZTC Sections">
      <thead>
        <tr>
          <th>#</th>
          <th>Course</th>
          <th>Term</th>
          <th>Section</th>
          <th>Instructor</th>
          <th>Units</th>
          <th>Days</th>
          <th>Time</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="9">Loading saved cart…</td></tr>
      </tbody>
      <tfoot>
        <tr><td id="totalItems" colspan="9">Total Items: 0</td></tr>
      </tfoot>
    </table>

    <div class="actions">
      <button id="copyList">Copy All</button>
      <button id="saveCsv">Save CSV</button>
      <button id="saveJson">Save (JSON)</button>
      <button id="printCart">Print / Save PDF</button>
      <button id="clearCart" class="danger">Clear Cart</button>
    </div>
  </main>

  <footer>
    <a href="index.html" class="btn">← Back to Search</a>
  </footer>

  <script>
  (function(){
    const STORAGE_KEY = 'wlacZtcCartV1';
    const tbody = document.querySelector('#cartTable tbody');
    const totalEl = document.getElementById('totalItems');

    const load = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; } };
    const save = (items) => localStorage.setItem(STORAGE_KEY, JSON.stringify(items));

    function render(){
      const items = load();
      if(!items.length){
        tbody.innerHTML = '<tr><td colspan="9">No items saved in your cart.</td></tr>';
        if(totalEl) totalEl.textContent = 'Total Items: 0';
        return;
      }
      tbody.innerHTML = items.map((i, idx)=>`
        <tr data-idx="${idx}">
          <td>${idx+1}</td>
          <td>${i.course||''}</td>
          <td>${i.term||''}</td>
          <td>${i.section||''}</td>
          <td>${i.instructor||''}</td>
          <td>${i.units||''}</td>
          <td>${i.days||''}</td>
          <td>${i.time||''}</td>
          <td>${i.location||''}</td>
        </tr>
      `).join('');
      if(totalEl) totalEl.textContent = 'Total Items: ' + items.length;
    }

    // Copy
    document.getElementById('copyList').addEventListener('click', ()=>{
      const items = load();
      const text = items.map(i => 
        [i.course, i.term, 'Sec '+(i.section||''), i.instructor, (i.units? i.units+' units':''), i.days, i.time, i.location]
        .filter(Boolean).join(' | ')
      ).join('\\n');
      navigator.clipboard.writeText(text).then(()=> alert('Cart copied to clipboard'));
    });

    // Save CSV (Term after Course)
    document.getElementById('saveCsv').addEventListener('click', ()=>{
      const items = load();
      const header = ['Course','Term','Section','Instructor','Units','Days','Time','Location'];
      const rows = items.map(i=>[i.course,i.term,i.section,i.instructor,i.units,i.days,i.time,i.location]);
      const csv = [header, ...rows]
        .map(r => r.map(v => `\"${String(v||'').replaceAll('\"','\"\"')}\"`).join(','))
        .join('\\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url  = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'wlac-ztc-cart.csv'; a.click();
      setTimeout(()=> URL.revokeObjectURL(url), 750);
    });

    // Save JSON
    document.getElementById('saveJson').addEventListener('click', ()=>{
      const data = JSON.stringify(load(), null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='wlac-ztc-cart.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 750);
    });

    // Print / Save PDF (simple window.print)
    document.getElementById('printCart').addEventListener('click', ()=> window.print());

    // Clear
    document.getElementById('clearCart').addEventListener('click', ()=>{
      if(confirm('Clear all items from your cart?')){
        save([]); render();
      }
    });

    render();
  })();
  </script>
</body>
</html>