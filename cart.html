<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WLAC ZTC — My Cart</title>
  <style>
    :root{
      --wlac-navy:#002147;
      --wlac-gold:#fdb813;
      --wlac-gray-100:#f7f7f8;
      --wlac-gray-200:#eeeeef;
      --text:#0f172a;
    }
    html,body{background:#fff;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
    header{padding:18px 12px;text-align:center}
    header h1{margin:.25rem 0;color:var(--wlac-navy);font-size:clamp(1.2rem,2vw+1rem,2rem)}
    .sub{color:#475569;margin:0}
    main{max-width:1100px;margin:0 auto;padding:16px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
    .btn{background:var(--wlac-gold);color:#000;border:1px solid transparent;border-radius:10px;padding:10px 12px;
         font-weight:700;text-decoration:none;display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    .btn.secondary{background:#f1f1f1;color:#000}
    .btn.danger{background:#ffe9e9;color:#b30000}
    .table-wrap{overflow:auto;border:1px solid var(--wlac-gray-200);border-radius:12px;background:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:0;background:var(--wlac-navy);color:#fff;font-weight:700;text-align:left;padding:12px;border-bottom:1px solid var(--wlac-gray-200)}
    tbody td{padding:10px 12px;border-bottom:1px solid var(--wlac-gray-200);vertical-align:top}
    tbody tr:nth-child(even){background:var(--wlac-gray-100)}
    tfoot td{padding:12px;font-weight:700}
    .empty{padding:24px;color:#475569;text-align:center}
    .right{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    .remove{background:transparent;border:0;color:#b30000;font-weight:700;cursor:pointer}
    footer{padding:22px 12px;text-align:center;color:#64748b}
  </style>
</head>
<body>
  <header>
    <h1>WLAC Zero Textbook Cost — My Cart</h1>
    <p class="sub">Saved sections from the ZTC Search page</p>
  </header>
  <main>
    <div class="actions">
      <a class="btn secondary" href="index.html">← Back to Search</a>
      <button class="btn" id="copyBtn">Copy All</button>
      <button class="btn" id="saveCsvBtn">Save CSV</button>
      <button class="btn" id="saveJsonBtn">Save (JSON)</button>
      <button class="btn" id="printBtn">Print / Save PDF</button>
      <button class="btn danger" id="clearBtn">Clear Cart</button>
    </div>

    <div id="tableMount" class="table-wrap"></div>
  </main>

  <footer>GO WEST. GO FAR. — West Los Angeles College</footer>

  <script>
    (function(){
      const KEY = 'wlacZtcCartV1';
      const mount = document.getElementById('tableMount');

      function load(){ try{return JSON.parse(localStorage.getItem(KEY))||[]}catch{return[]} }
      function save(items){ localStorage.setItem(KEY, JSON.stringify(items)); }
      function fmt(i){
        return [i.instructor, i.units && (i.units+' units'), i.days, i.time, i.location]
          .filter(Boolean).join(' | ');
      }

      function render(){
        const items = load();
        if(!items.length){
          mount.innerHTML = '<div class="empty">Your cart is empty. Go back to the Search page to add ZTC sections.</div>';
          return;
        }
        const rows = items.map((i,idx)=>`
          <tr>
            <td>${idx+1}</td>
            <td>${i.course||''}</td>
            <td>${i.term||''}</td>
            <td>${i.section||''}</td>
            <td>${i.instructor||''}</td>
            <td>${i.units||''}</td>
            <td>${i.days||''}</td>
            <td>${i.time||''}</td>
            <td>${i.location||''}</td>
            <td class="right"><button class="remove" data-idx="${idx}">Remove</button></td>
          </tr>
        `).join('');

        mount.innerHTML = `
          <table aria-label="Saved ZTC sections">
            <thead>
              <tr><th>#</th><th>Course</th><th>Term</th><th>Section</th><th>Instructor</th><th>Units</th><th>Days</th><th>Time</th><th>Location</th><th>Action</th></tr>
            </thead>
            <tbody>${rows}</tbody>
            <tfoot><tr><td colspan="10">Total Items: ${items.length}</td></tr></tfoot>
          </table>
        `;
      }

      // Actions
      document.getElementById('copyBtn').addEventListener('click', ()=>{
        const text = load().map(i=>`${i.course} | ${i.term||''} | Sec ${i.section} | ${fmt(i)}`).join('\n');
        navigator.clipboard.writeText(text).then(()=> alert('Cart copied to clipboard'));
      });

      document.getElementById('saveCsvBtn').addEventListener('click', ()=>{
        const header = ['Course','Term','Section','Instructor','Units','Days','Time','Location'];
        const rows = load().map(i=>[i.course,i.term,i.section,i.instructor,i.units,i.days,i.time,i.location]);
        const csv = [header,...rows].map(r=>r.map(v=>`"${(v||'').replaceAll('"','""')}"`).join(',')).join('\n');
        const blob = new Blob([csv], {type:'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='wlac-ztc-cart.csv'; a.click();
        setTimeout(()=>URL.revokeObjectURL(url),500);
      });

      document.getElementById('saveJsonBtn').addEventListener('click', ()=>{
        const data = JSON.stringify(load(), null, 2);
        const blob = new Blob([data], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='wlac-ztc-cart.json'; a.click();
        setTimeout(()=>URL.revokeObjectURL(url),500);
      });

      document.getElementById('printBtn').addEventListener('click', ()=>{
        const items = load();
        const rows = items.map((i,idx)=>`
          <tr>
            <td>${idx+1}</td>
            <td>${i.course||''}</td>
            <td>${i.term||''}</td>
            <td>${i.section||''}</td>
            <td>${i.instructor||''}</td>
            <td>${i.units||''}</td>
            <td>${i.days||''}</td>
            <td>${i.time||''}</td>
            <td>${i.location||''}</td>
          </tr>
        `).join('');
        const win = window.open('', '_blank');
        win.document.write(`
          <!DOCTYPE html><html><head><meta charset="utf-8"><title>WLAC ZTC Cart</title>
          <style>
            :root{ --navy:#002147; --gold:#fdb813; --gray:#eaeaec; }
            body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:24px; }
            h1{ margin:0 0 4px; color:var(--navy); }
            .meta{ color:#333; margin-bottom:14px; font-size:.95rem; }
            table{ width:100%; border-collapse:collapse; }
            th, td{ border:1px solid var(--gray); padding:8px; text-align:left; }
            thead th{ background:var(--navy); color:#fff; }
            tfoot td{ border:0; padding-top:10px; font-weight:700; }
            @media print{ @page{ size:auto; margin:12mm; } }
          </style>
          </head><body>
          <h1>WLAC Zero Textbook Cost — My Cart</h1>
          <div class="meta">Generated on ${new Date().toLocaleString()}</div>
          <table>
            <thead>
              <tr><th>#</th><th>Course</th><th>Term</th><th>Section</th><th>Instructor</th><th>Units</th><th>Days</th><th>Time</th><th>Location</th></tr>
            </thead>
            <tbody>${rows || '<tr><td colspan="9">No items in cart.</td></tr>'}</tbody>
            <tfoot><tr><td colspan="9">Total Items: ${items.length}</td></tr></tfoot>
          </table>
          <script>window.addEventListener('load', ()=> window.print());</script>
          </body></html>
        `);
        win.document.close();
      });

      document.getElementById('clearBtn').addEventListener('click', ()=>{
        if(confirm('Clear all items from your cart?')){ save([]); render(); }
      });

      // Remove handler (event delegation)
      document.addEventListener('click', (e)=>{
        if(e.target.matches('.remove')){
          const idx = +e.target.getAttribute('data-idx');
          const items = load();
          items.splice(idx,1);
          save(items);
          render();
        }
      });

      render();
    })();
  </script>
</body>
</html>
